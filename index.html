<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Watermeter · CSV viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="py-6 bg-gradient-to-br from-sky-200 via-white to-indigo-200">
  <div class="max-w-5xl mx-auto px-4 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <img src="assets/logo_primary.jpg?v=3" alt="Logo" class="h-12 w-auto object-contain" />
      <span class="text-xl font-extrabold">Admin Watermeter</span>
    </div>
    <div class="flex items-center gap-3">
      <img src="assets/logo_secondary.jpg?v=3" alt="Partner" class="h-8 w-auto object-contain opacity-80 hidden sm:block" />
      <a href="admin.html" class="px-3 py-2 text-sm rounded-lg bg-white/70 hover:bg-white">Admin</a>
    </div>
  </div>
</header>


  <main class="max-w-5xl mx-auto px-4 py-8 space-y-8">
    <section class="p-5 rounded-2xl bg-white shadow ring-1 ring-slate-200">
      <h1 class="text-2xl font-bold">CSV Viewer</h1>
      <p class="mt-1 text-sm opacity-80">Upload i wak bo CSV di watermeters. <span class="font-semibold">Sin backend</span>.</p>
    </section>

    <section class="grid md:grid-cols-2 gap-6">
      <div class="p-6 rounded-2xl bg-white shadow ring-1 ring-slate-200">
        <h2 class="text-xl font-bold">1) Upload CSV</h2>
        <p class="mt-1 text-sm opacity-80">Formato rekomendá: <code>meter_id,date,reading,unit,notes</code></p>
        <input id="fileInput" type="file" accept=".csv" class="mt-4 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-sky-600 file:text-white hover:file:bg-sky-700"/>
        <p id="status" class="mt-2 text-sm text-slate-500"></p>
      </div>
      <div class="p-6 rounded-2xl bg-white shadow ring-1 ring-slate-200">
        <h2 class="text-xl font-bold">2) Sample data</h2>
        <pre class="mt-3 p-3 bg-slate-100 rounded-lg text-xs overflow-x-auto">meter_id,date,reading,unit,notes
A-101,2025-09-01,1287,m³,Monthly check
A-101,2025-10-01,1312,m³,OK
B-009,2025-10-01,875,m³,Suspected leak</pre>
        <a href="data/sample.csv" class="inline-block mt-3 px-3 py-2 text-sm rounded-lg bg-slate-100 hover:bg-slate-200">Download sample.csv</a>
      </div>
    </section>

    <section class="p-6 rounded-2xl bg-white shadow ring-1 ring-slate-200">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold">Preview</h2>
        <div class="flex items-center gap-2">
          <button id="exportBtn" class="px-3 py-2 text-sm rounded-lg bg-sky-600 text-white hover:bg-sky-700">Export</button>
          <button id="clearBtn" class="px-3 py-2 text-sm rounded-lg bg-slate-100 hover:bg-slate-200">Clear</button>
        </div>
      </div>
      <div id="tableWrap" class="mt-4 overflow-x-auto">
        <table id="dataTable" class="min-w-full text-sm hidden">
          <thead class="bg-slate-100"></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="py-8 text-center text-xs opacity-70">
    © <span id="year"></span> Admin Watermeter
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    const fileInput=document.getElementById('fileInput'),status=document.getElementById('status');
    const table=document.getElementById('dataTable'),thead=table.querySelector('thead'),tbody=table.querySelector('tbody');
    function parseCSV(t){return t.replace(/\r\n?/g,'\n').split('\n').filter(l=>l.trim()!='').map(l=>l.split(','));}
    function renderTable(r){if(!r||r.length==0)return;thead.innerHTML='';tbody.innerHTML='';const trh=document.createElement('tr');r[0].forEach(h=>{const th=document.createElement('th');th.className='px-3 py-2 text-left font-semibold';th.textContent=h;trh.appendChild(th);});thead.appendChild(trh);r.slice(1).forEach(rr=>{const tr=document.createElement('tr');tr.className='border-b';rr.forEach(v=>{const td=document.createElement('td');td.className='px-3 py-2';td.textContent=v;tr.appendChild(td);});tbody.appendChild(tr);});table.classList.remove('hidden');}
    fileInput.addEventListener('change',async e=>{const f=e.target.files?.[0];if(!f)return;status.textContent='Loading '+f.name+'...';const t=await f.text(),r=parseCSV(t);if(r.length<2){status.textContent='Invalid CSV';return;}renderTable(r);status.textContent='Loaded '+(r.length-1)+' rows.';});
    document.getElementById('clearBtn').onclick=()=>{thead.innerHTML='';tbody.innerHTML='';table.classList.add('hidden');fileInput.value='';status.textContent='';};
    document.getElementById('exportBtn').onclick=()=>{const h=[...thead.querySelectorAll('th')].map(x=>x.textContent).join(',');const b=[...tbody.querySelectorAll('tr')].map(tr=>[...tr.querySelectorAll('td')].map(td=>td.textContent).join(',')).join('\n');const blob=new Blob([h+'\n'+b],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='export.csv';a.click();};
  </script>
</body>
</html>